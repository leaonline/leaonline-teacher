<template name="myClasses">
    {{#unless dataComplete}}
        {{> loading}}
    {{/unless}}

    {{#each course in courses}}
        <div class="w-100">{{course.title}}</div>
    {{/each}}

    {{#onLoaded loaded=componentsLoaded}}
        <div class="d-flex justify-content-end w-100">
            {{> button
                    data-toggle="modal"
                    data-target="#add-course-modal"
                    colortype="primary"
                    sm=true
                    label=(i18n "pages.myClasses.addNew")}}
        </div>

        <h4>
            <span class="ml-5 badge badge-secondary shadow-sm bg-white text-secondary course-badge">
                {{i18n "pages.myClasses.running"}}
            </span>
        </h4>

        {{#listgroup flush=true class="mb-5 border-0 rounded-lg shadow-sm" style=" overflow: hidden;"}}
            {{#each document in runningCourses}}
                {{> cardItems course=document courseRoute=getEntryRoute}}
            {{else}}
                {{# item class="d-flex align-items-center p-3 bg-light text-muted"}}
                    {{i18n "pages.myClasses.notFound"}}
                {{/item}}
            {{/each}}
        {{/listgroup}}

        <h4><span class="ml-5 badge badge-secondary shadow-sm bg-white text-secondary course-badge">{{i18n
                "pages.myClasses.completed"}}</span></h4>
        {{#listgroup flush=true class="mb-5 border-0 rounded-lg shadow-sm" style=" overflow: hidden;"}}
            {{#each document in completedCourses}}
                {{> cardItems course=document courseRoute=getEntryRoute}}
            {{else}}
                {{# item class="d-flex align-items-center p-3 bg-light text-muted"}}
                    {{i18n "pages.myClasses.notFound"}}
                {{/item}}
            {{/each}}
        {{/listgroup}}

        <h4><span class="ml-5 badge badge-secondary shadow-sm bg-white text-secondary course-badge">{{i18n
                "pages.myClasses.upcoming"}}</span></h4>
        {{#listgroup flush=true class="mb-5 border-0 rounded-lg shadow-sm" style=" overflow: hidden;"}}
            {{#each document in notStartedCourses}}
                {{> cardItems course=document courseRoute=getEntryRoute}}
            {{else}}
                {{# item class="d-flex align-items-center p-3 bg-light text-muted"}}
                    {{i18n "pages.myClasses.notFound"}}
                {{/item}}
            {{/each}}
        {{/listgroup}}

        <h4><span class="ml-5 badge badge-secondary shadow-sm bg-white text-secondary course-badge">Users</span></h4>
        {{#listgroup flush=true class="mb-5 border-0 rounded-lg shadow-sm" style=" overflow: hidden;"}}
            {{#each document in activeUsers}}
                <li class="list-group-item p-3">
                    <div class="row">
                        <div class="col d-flex justify-content-between align-items-center text-secondary no-wrap">
                            <a href="{{route getUserRoute document.courseId document.id}}">
                                {{document.lastName}} {{document.firstName}} {{#if document.id}}({{document.id}}){{/if}}
                            </a>
                            <a href="{{route getClickedCourse document.courseId}}">
                                {{#with getCourse document.courseId}}{{this.title}}{{/with}}
                            </a>
                        </div>
                        <div class="col d-flex justify-content-end align-items-center no-wrap">
                            {{#button size="sm" colortype="secondary" outline=true class="mr-2 course-items-icon-buttons"}}
                                <span class="fa fas fa-fw fa-eye"></span>
                            {{/button}}
                        </div>
                    </div>
                </li>
            {{else}}
                {{# item class="d-flex align-items-center p-3 bg-light text-muted"}}
                    {{i18n "pages.myClasses.notFound"}}
                {{/item}}
            {{/each}}
        {{/listgroup}}

        {{#modal id="add-course-modal" centered=true large=true}}
            {{> modalheader title=(i18n "pages.myClasses.modal.header.addCourse") dismiss=true class="bg-primary text-white"}}
            {{#modalbody}}
                {{#autoForm schema=courseSchema id="insertCourseForm" type="normal"}}
                    <fieldset>
                        <p>{{i18n "pages.myClasses.modal.body.addCourse.title"}}</p>
                        <div class="row">
                            <div class="col-12 py-2">
                                {{> afQuickField name='title' }}
                            </div>
                            <div class="col-md-6 py-2">
                                {{> afQuickField name='startsAt' label="myClasses.startsAt"}}
                            </div>
                            <div class="col-md-6 py-2">
                                {{> afQuickField name='completesAt' label="myClasses.completesAt"}}
                            </div>
                        </div>
                    </fieldset>
                    <div class="mt-4"></div>
                    {{> afArrayField name='users' class="mt-4"}}
                {{/autoForm}}
            {{/modalbody}}
            {{#modalfooter}}
                {{> button colortype="secondary" data-dismiss="modal" label=(i18n "actions.close")}}
                {{> button type="submit" form="insertCourseForm" colortype="primary" label=(i18n "actions.insert") class="insert"}}
            {{/modalfooter}}
        {{/modal}}

        {{#modal id="edit-course-modal" centered=true large=true}}
            {{>modalheader title=(i18n "pages.myClasses.modal.header.editCourse") dismiss=true class="bg-primary text-white"}}
            {{#modalbody}}
                {{#autoForm doc=getClickedCourse  schema=courseSchema id="editCourseForm" type="normal"}}
                    <fieldset>
                        <span>{{i18n "pages.myClasses.modal.body.editCourse.title"}}</span>
                        <div class="row">
                            <div class="col-12 py-2">
                                {{> afQuickField name='title' }}
                            </div>
                            <div class="col-md-6 py-2">
                                {{> afQuickField name='startsAt' label="myClasses.startsAt"}}
                            </div>
                            <div class="col-md-6 py-2">
                                {{> afQuickField name='completesAt' label="myClasses.completesAt"}}
                            </div>
                        </div>
                    </fieldset>
                    <div class="mt-4"></div>
                    {{> afArrayField name='users' class="mt-4"}}
                {{/autoForm}}
            {{/modalbody}}
            {{#modalfooter}}
                {{> button colortype="secondary" data-dismiss="modal" label=(i18n "actions.close")}}
                {{> button type="submit" colortype="primary" label=(i18n "actions.update") class="save-changes" form="editCourseForm"}}
            {{/modalfooter}}
        {{/modal}}

        {{#modal id="delete-course-modal" centered=true}}
            {{>modalheader title=(i18n "pages.myClasses.modal.header.deleteCourse") dismiss=true class="bg-danger"}}
            {{#modalbody}}
                <div>{{i18n "pages.myClasses.modal.body.deleteCourse.title"}}</div>
            {{/modalbody}}
            {{#modalfooter}}
                {{> button colortype="secondary" data-dismiss="modal" label=(i18n "actions.close")}}
                {{> button type="submit" colortype="primary" label=(i18n "actions.delete") class="delete-course-button"}}
            {{/modalfooter}}
        {{/modal}}
    {{/onLoaded}}

</template>

<template name="cardItems">
    <li class="list-group-item p-3">
        <div class="row">
            <div class="col d-flex align-items-center text-secondary no-wrap">
                <a href="{{route courseRoute course._id}}">
                    {{course.title}}
                </a>
            </div>
            <div class="col d-flex justify-content-end align-items-center no-wrap">
                {{#button size="sm" colortype="secondary" outline=true class="mr-2 course-items-icon-buttons"}}
                    <span class="fa fas fa-fw fa-eye"></span>
                {{/button}}
                {{#button data-course=course._id data-toggle="modal" data-target="#edit-course-modal" size="sm"
                          colortype="success" outline=true class="mr-2 course-items-icon-buttons update-course"}}
                    <span class="fa fas fa-fw fa-edit"></span>
                {{/button}}
                {{#button data-course=course._id size="sm" colortype="danger" outline=true
                          class="mr-1 course-items-icon-buttons delete-course-icon"}}
                    <span class="fa fas fa-fw fa-trash"></span>
                {{/button}}
            </div>
        </div>
    </li>
</template>
