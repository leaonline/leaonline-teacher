<template name="myClasses">
    {{#unless dataComplete}}
        {{> loading}}
    {{/unless}}

    {{#onLoaded loaded=componentsLoaded}}
        <div class="d-flex justify-content-end w-100 align-items-baseline {{#if
                noCourses}}alert alert-warning{{/if}}">
            {{#if noCourses}}
                <span class="px-4">{{i18n
                        "pages.myClasses.noCoursesYet"}}</span>
            {{/if}}
            {{> button
                    class="ml-auto"
                    data-toggle="modal"
                    data-target="#add-course-modal"
                    colortype="primary"
                    sm=true
                    label=(i18n "pages.myClasses.addNew")}}
        </div>



        {{! RUNNING COURSES }}
        {{#with runningCourses}}
            <h4>
        <span class="ml-5 badge badge-secondary shadow-sm bg-white text-secondary course-badge">
            {{i18n "pages.myClasses.running"}}
        </span>
            </h4>

            {{#listgroup flush=true class="mb-5 border-0 rounded-lg shadow-sm"
                         style=" overflow: hidden;"}}
                {{#each document in ..}}
                    {{> cardItems course=document courseRoute=getEntryRoute}}
                {{else}}
                    {{#item class="d-flex align-items-center p-3 bg-light text-muted"}}
                        {{i18n "pages.myClasses.notFound"}}
                    {{/item}}
                {{/each}}
            {{/listgroup}}
        {{/with}}


        {{! COMPLETED COURSES }}
        {{#with completedCourses}}
            <h4>
        <span class="ml-5 badge badge-secondary shadow-sm bg-white text-secondary course-badge">
            {{i18n "pages.myClasses.completed"}}
        </span>
            </h4>

            {{#listgroup flush=true class="mb-5 border-0 rounded-lg shadow-sm"
                         style=" overflow: hidden;"}}
                {{#each document in ..}}
                    {{> cardItems course=document courseRoute=getEntryRoute}}
                {{else}}
                    {{# item
                            class="d-flex align-items-center p-3 bg-light text-muted"}}
                        {{i18n "pages.myClasses.notFound"}}
                    {{/item}}
                {{/each}}
            {{/listgroup}}
        {{/with}}

        {{! UPCOMING COURSES }}
        {{#with notStartedCourses}}
            <h4>
            <span class="ml-5 badge badge-secondary shadow-sm bg-white text-secondary course-badge">
                {{i18n "pages.myClasses.upcoming"}}
            </span>
            </h4>

            {{#listgroup flush=true class="mb-5 border-0 rounded-lg shadow-sm"
                         style=" overflow: hidden;"}}
                {{#each document in ..}}
                    {{> cardItems course=document courseRoute=getEntryRoute}}
                {{else}}
                    {{# item
                            class="d-flex align-items-center p-3 bg-light text-muted"}}
                        {{i18n "pages.myClasses.notFound"}}
                    {{/item}}
                {{/each}}
            {{/listgroup}}
        {{/with}}

        {{! ALL USERS }}
        <h4>
        <span class="ml-5 badge badge-secondary shadow-sm bg-white text-secondary course-badge">
            {{i18n "pages.myClasses.users"}}
        </span>
        </h4>

        <div class="table-responsive mt-3 shadow-sm">
            <table class="table table-hover m-0">
                <tbody>
                {{#each document in activeUsers}}
                    <tr class="bg-white">
                        <td class="text-center px-4">
                            {{#if document.code}}
                                <code>{{document.code}}</code>
                            {{else}}
                                <small class="text-light">
                                    {{> icon name="exclamation-triangle"}}
                                </small>
                            {{/if}}
                        </td>
                        <td class="text-left px-4">
                            <a href="{{route getUserRoute document.courseId
                                             document.code}}">
                                {{document.lastName}}
                            </a>
                        </td>
                        <td class="text-left px-4">
                            <a href="{{route getUserRoute document.courseId
                                             document.code}}">
                                {{document.firstName}}
                            </a>
                        </td>
                        <td class="w-100">
                            <a href="{{route getEntryRoute
                                             document.courseId}}">
                                {{#with getCourse
                                        document.courseId}}{{this.title}}{{/with}}
                            </a>
                        </td>

                        <td class="text-right">
                            <button class="btn btn-sm btn-outline-success edit-user-btn">
                                {{> icon name="edit"}}
                            </button>
                        </td>
                    </tr>
                {{/each}}
                </tbody>
            </table>
        </div>

        {{! INSERT MODAL }}
        {{#modal id="add-course-modal" centered=true large=true}}
            {{> modalheader title=(i18n "pages.myClasses.modal.header.addCourse") dismiss=true class="bg-primary text-white"}}
            {{#modalbody}}
                {{> quickForm id="insertCourseForm" schema=courseSchema type="normal" buttonClasses="d-none"}}
            {{/modalbody}}
            {{#modalfooter}}
                <div class="d-flex justify-content-between w-100">
                    {{> button type="submit" form="insertCourseForm" colortype="primary" label=(i18n "actions.insert") class="insert"}}
                    {{> button colortype="secondary" outline=true data-dismiss="modal" label=(i18n "actions.cancel")}}
                </div>
            {{/modalfooter}}
        {{/modal}}

        {{! UPDATE MODAL }}
        {{#modal id="edit-course-modal" centered=true large=true}}
            {{>modalheader title=(i18n "pages.myClasses.modal.header.editCourse") dismiss=true class="bg-success text-white"}}
            {{#modalbody}}
                {{> quickForm id="editCourseForm" schema=courseSchema type="normal" buttonClasses="d-none" doc=getClickedCourse}}
            {{/modalbody}}
            {{#modalfooter}}
                <div class="d-flex justify-content-between w-100">
                    {{> button type="submit" colortype="success" label=(i18n "actions.update") class="save-changes" form="editCourseForm"}}
                    {{> button colortype="secondary" outline=true data-dismiss="modal" label=(i18n "actions.cancel")}}
                </div>
            {{/modalfooter}}
        {{/modal}}

        {{! REMOVE MODAL }}
        {{#modal id="delete-course-modal" centered=true}}
            {{>modalheader title=(i18n "pages.myClasses.modal.header.deleteCourse") dismiss=true class="bg-danger text-white"}}
            {{#modalbody}}
                <div>{{i18n
                        "pages.myClasses.modal.body.deleteCourse.title"}}</div>
            {{/modalbody}}
            {{#modalfooter}}
                <div class="d-flex justify-content-between w-100">
                    {{> button type="submit" colortype="danger" label=(i18n "actions.archive") class="delete-course-button"}}
                    {{> button colortype="secondary" outline=true data-dismiss="modal" label=(i18n "actions.cancel")}}
                </div>
            {{/modalfooter}}
        {{/modal}}
    {{/onLoaded}}

</template>

<template name="cardItems">
    <li class="list-group-item p-3">
        <div class="row">
            <div class="col d-flex align-items-center text-secondary no-wrap">
                <a href="{{route courseRoute course._id}}">
                    {{course.title}}
                </a>
            </div>
            <div class="col d-flex justify-content-end align-items-center no-wrap">
                {{!--
                {{#button size="sm" colortype="secondary" outline=true
                          class="mr-2 course-items-icon-buttons"}}
                    <span class="fa fas fa-fw fa-eye"></span>
                {{/button}}
                --}}
                {{#button data-course=course._id data-toggle="modal"
                          data-target="#edit-course-modal" size="sm"
                          colortype="success" outline=true
                          class="mr-2 course-items-icon-buttons update-course"}}
                    <span class="fa fas fa-fw fa-edit"></span>
                {{/button}}
                {{#button data-course=course._id size="sm" colortype="danger"
                          outline=true
                          class="mr-1 course-items-icon-buttons delete-course-icon"}}
                    <span class="fa fas fa-fw fa-trash"></span>
                {{/button}}
            </div>
        </div>
    </li>
</template>
